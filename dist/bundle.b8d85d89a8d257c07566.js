!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="./",s(s.s=0)}([function(e,t,s){"use strict";s(1);var i=o(s(2)),n=o(s(5)),l=o(s(6)),a=s(9),r=o(s(10));function o(e){return e&&e.__esModule?e:{default:e}}new l.default(document.getElementById("popup"),function(e,t){const s="preset"===e,l=new r.default(document.getElementById("panel"),!s,function(){o=!1,v.step()},function(e){p=e});let o=!0,c=0,h={cols:30,rows:30},d=[],u=void 0,p=100;"preset"===e&&(h=t.size,d=t.seeds,u=t.cellSizeAtScale1);"empty"===e&&(h=t);const f=new i.default({size:h,displayElement:document.getElementById("display"),cellSizeAtScale1:u,onCellClick:function([e,t]){o&&v.populate([[e,t]])}}),m=(0,a.getCalcSpentAvg2)((e,t)=>l.updateSpentIndication(e,t)),v=new n.default({size:h,onIterationComplete:function(e,t,s,i,n){c++,l.updateIterationsIndicator(c),f.render(e,t,s,n),m(i),o||setTimeout(()=>v.step(),p)},onPopulateComplete:function(e,t,s,i){f.render(e,t,s)}});"preset"===e&&v.populate(d);s&&(o=!1,v.step())}).show()},function(e,t){},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(s(3)),n=l(s(4));function l(e){return e&&e.__esModule?e:{default:e}}t.default=class extends n.default{constructor(e){super(e),this.canvas=null,this.lastKnownUniverseState=null,this.translateY=0,this.translateX=0,this.cellSizeAtScale1=10,this.scale=1,this.align=.5,this.draggable=!1,this.skipNextOnClick=!1,this.cellSizeAtScale1=e.cellSizeAtScale1||this.cellSizeAtScale1,this.cellSize=this.cellSizeAtScale1,this.prepareDOM(),window.addEventListener("resize",this.onWindowResize.bind(this))}prepareDOM(){const e=document.createElement("div");e.classList.add(i.default.wrapper),e.addEventListener("wheel",this.onWrapperWheel.bind(this));const t=document.createElement("canvas");t.classList.add(i.default.canvas),t.addEventListener("click",this.onCanvasClick.bind(this)),t.addEventListener("mousedown",this.onMouseDown.bind(this)),t.addEventListener("mouseout",this.onMouseOut.bind(this)),t.addEventListener("mousemove",this.onMouseMove.bind(this)),t.addEventListener("mouseup",this.onMouseUp.bind(this));const s=t.getContext("2d");this.ctx=s,this.displayElement.appendChild(e),e.appendChild(t),this.wrapper=e,this.canvas=t,this.setCanvasSize(),this.drawGrid()}setCanvasSize(){this.canvas.setAttribute("width",this.wrapper.clientWidth),this.canvas.setAttribute("height",this.wrapper.clientHeight)}drawLine(e,t,s,i,n){e.beginPath(),e.moveTo(t,s),e.lineTo(i,n),e.stroke()}setCell(e,t,s=!1){const{align:i,cellSize:n,ctx:l}=this;l.fillStyle="black",l[s?"fillRect":"clearRect"](n*e+2*i+Math.round(this.translateX*this.scale),n*t+2*i+Math.round(this.translateY*this.scale),n-2*i,n-2*i)}drawGrid(){const{cols:e,rows:t}=this.size,{align:s,cellSize:i,ctx:n}=this;n.clearRect(0,0,this.canvas.width,this.canvas.height),n.strokeStyle="lightgray",n.lineWidth=1;const l=Math.round(this.translateX*this.scale),a=Math.round(this.translateY*this.scale);for(let r=0;r<=t;r++)this.drawLine(n,s+l,r*i+s+a,e*i+s+l,r*i+s+a);for(let r=0;r<=e;r++)this.drawLine(n,r*i+s+l,s+a,r*i+s+l,t*i+s+a)}onWrapperWheel(e){const t=e.deltaY<1,s=this.scale*(t?2:.5),i=this.cellSizeAtScale1*s;i>1&&(this.translateX+=e.offsetX/this.scale*(this.scale-s)/s,this.translateY+=e.offsetY/this.scale*(this.scale-s)/s,this.cellSize=i,this.scale=s,this.redraw())}onWindowResize(){this.setCanvasSize(),this.redraw()}onCanvasClick(e){if(this.skipNextOnClick)return void(this.skipNextOnClick=!1);const t=Math.floor((e.offsetX-this.translateX*this.scale)/this.cellSize),s=Math.floor((e.offsetY-this.translateY*this.scale)/this.cellSize);t>=0&&t<this.size.cols&&s>=0&&s<this.size.rows&&this.onCellClick([t,s])}onMouseDown(e){this.draggable=!0}onMouseUp(e){this.draggable=!1}onMouseMove(e){this.draggable&&(this.translateX+=e.movementX/this.scale,this.translateY+=e.movementY/this.scale,this.redraw(),this.skipNextOnClick=!0)}onMouseOut(e){this.draggable=!1}redraw(){this.drawGrid(),this.redrawLastKnownUniverseState()}redrawLastKnownUniverseState(){const e=this.lastKnownUniverseState;if(e)for(let t=0;t<e.length;t++)for(let s=0;s<e[t].length;s++)e[t][s]&&this.setCell(t,s,!0);this.lastKnownQuadtree&&this.drawSleepy(this.lastKnownQuadtree)}drawSleepy(e){if(e.children)e.children.forEach(e=>this.drawSleepy(e));else if(e.sleepy){const{align:t,cellSize:s,ctx:i}=this;i.fillStyle="rgba(0, 255, 0, 0.5)",i.fillRect(s*e.from[0]+2*t+Math.round(this.translateX*this.scale),s*e.from[1]+2*t+Math.round(this.translateY*this.scale),s*(e.to[0]-e.from[0]+1)-2*t,s*(e.to[1]-e.from[1]+1)-2*t)}}render(e,t,s,i){if(this.lastKnownUniverseState=e,this.lastKnownQuadtree=i,!i){for(let e=0;e<t.length;e++)this.setCell(t[e][0],t[e][1],!0);for(let e=0;e<s.length;e++)this.setCell(s[e][0],s[e][1],!1)}i&&(this.redraw(),this.drawSleepy(i))}}},function(e,t){e.exports={wrapper:"wrapper__3xCbm",canvas:"canvas__2jM83"}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor({size:e,displayElement:t,onCellClick:s}){this.size={cols:20,rows:10},this.size=e,this.displayElement=t,this.onCellClick=s}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e};t.default=class{constructor({size:e,onIterationComplete:t,onPopulateComplete:s}){this.size=e,this.onIterationComplete=t,this.onPopulateComplete=s;const{cols:i,rows:n}=e;this.universeState=Array(i).fill().map(e=>Array(n).fill())}showDebugTree(e){const t=(e,s)=>{console.log(new Array(s).fill("\t").join("")+e.from.join(";")+" -> "+e.to.join(";")),s++,e.children&&e.children.forEach(e=>t(e,s))};t(e,0)}getQuadtree(e,t,s){const n={from:[0,0],to:[this.size.cols-1,this.size.rows-1],sleepy:!0,children:null};return[...e,...t,...s].forEach(e=>(function e(t,s,n){s[0]>=t.from[0]&&s[1]>=t.from[1]&&s[0]<=t.to[0]&&s[1]<=t.to[1]&&(t.sleepy=!1,t.children?t.children.forEach(t=>e(t,s,++n)):t.to[0]-t.from[0]>=20&&t.to[1]-t.from[1]>=20&&(t.children=function(e){const{from:t,to:s}=e,n=t[0]+Math.floor((s[0]-t[0])/2),l=t[1]+Math.floor((s[1]-t[1])/2);return[{from:t,to:[n,l]},{from:[n+1,t[1]],to:[s[0],l]},{from:[t[0],l+1],to:[n,s[1]]},{from:[n+1,l+1],to:s}].map(e=>i({},e,{sleepy:!0,children:null}))}(t),t.children.forEach(t=>e(t,s,++n))))})(n,e,0)),n}populate(e){const t=[],s=[],i=this.universeState;e.forEach(([e,n])=>{i[e][n]?s.push([e,n]):t.push([e,n]),i[e][n]=!i[e][n]});const n=[];for(let e=0;e<i.length;e++)for(let t=0;t<i[e].length;t++)i[e][t]&&n.push([e,t]);this.onPopulateComplete(this.universeState,t,s,n)}step(){const e=Date.now(),t=[],s=[],i=[],n=this.universeState;for(let e=0;e<n.length;e++)for(let l=0;l<n[e].length;l++){const a=this.getAdjacent(e,l).reduce((e,[t,s])=>e+=n[t][s]?1:0,0);n[e][l]?a<2||a>3?s.push([e,l]):i.push([e,l]):3===a&&t.push([e,l])}t.forEach(([e,t])=>this.universeState[e][t]=!0),s.forEach(([e,t])=>this.universeState[e][t]=!1);const l=this.getQuadtree(t,i,s),a=Date.now()-e;this.onIterationComplete(this.universeState,t,s,a,l)}getAdjacent(e,t){const{cols:s,rows:i}=this.size;return[[e,0===t?i-1:t-1],[e===s-1?0:e+1,0===t?i-1:t-1],[e===s-1?0:e+1,t],[e===s-1?0:e+1,t===i-1?0:t+1],[e,t===i-1?0:t+1],[0===e?s-1:e-1,t===i-1?0:t+1],[0===e?s-1:e-1,t],[0===e?s-1:e-1,0===t?i-1:t-1]]}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(s(7)),n=l(s(8));function l(e){return e&&e.__esModule?e:{default:e}}t.default=class{constructor(e,t){this.presetClickListener=(e=>{e.preventDefault();const t=n.default[+e.target.getAttribute("data-preset-index")];setTimeout(()=>this.onPopupClose("preset",t),0),this.hide()}),this.btnClickListener=(e=>{const t=+this.cols.value,s=+this.rows.value;!isNaN(t)&&!isNaN(s)&&t>0&&s>0&&(setTimeout(()=>this.onPopupClose("empty",{cols:t,rows:s}),0),this.hide())}),this.element=e,this.onPopupClose=t}show(){const e=[],t=document.createElement("p");t.innerHTML="Выберите пресет:",e.push(t),n.default.forEach((t,s)=>{const i=document.createElement("a");i.setAttribute("href","#"),i.setAttribute("data-preset-index",s),i.innerHTML=t.name,i.addEventListener("click",this.presetClickListener),e.push(i)});const s=document.createElement("p");s.innerHTML="Или создайте пустую вселенную<br /> размером <em>cols</em> &times; <em>rows</em>:",e.push(s);const l=document.createElement("div");l.classList.add(i.default.form),this.cols=document.createElement("input"),this.cols.value=100,this.rows=document.createElement("input"),this.rows.value=50,this.btn=document.createElement("button"),this.btn.innerHTML="Создать",this.btn.addEventListener("click",this.btnClickListener),this.cols.setAttribute("placeholder","cols"),this.rows.setAttribute("placeholder","rows"),[this.cols,this.rows,this.btn].forEach(e=>{l.appendChild(e)}),e.push(l),this.element.classList.add(i.default.visible),e.forEach(e=>this.element.appendChild(e))}hide(){Array.from(this.element.querySelectorAll("a")).forEach(e=>e.removeEventListener("click",this.presetClickListener)),this.element.classList.remove(i.default.visible),this.element.innerHTML="",this.cols=null,this.rows=null,this.btn.removeEventListener("click",this.btnClickListener),this.btn=null}}},function(e,t){e.exports={visible:"visible__34mU7",form:"form__1kg0u"}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=[{name:"Смерть героя",size:{cols:32,rows:32},seeds:[[2,5],[3,5],[4,5],[21,20],[22,21],[20,22],[21,22],[22,22]]},{name:"Трое в лодке, не считая собаки",size:{cols:30,rows:30},seeds:[[2,5],[3,5],[4,5],[3,4],[3,6],[21,20],[22,21],[20,22],[21,22],[22,22]]},{name:"Безмятежность",size:{cols:50,rows:50},seeds:[[24,23],[24,24],[25,23],[25,25],[26,24],[26,25]],cellSizeAtScale1:8},{name:"Старик и море",size:{cols:1200,rows:1e3},seeds:[[21,20],[22,21],[20,22],[21,22],[22,22]],cellSizeAtScale1:2},{name:"У страха глаза велики",size:{cols:11,rows:10},seeds:[[2,4],[3,4],[4,4],[5,4],[5,5],[5,6],[6,4],[7,4],[8,4]],cellSizeAtScale1:20}]},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e};t.getCalcSpentAvg=function(e){const t={sum:0,n:0};let s=i({},t);return n=>{s.sum+=n,s.n++,10===s.n&&(e(10,(s.sum/10).toFixed(1)),s=i({},t))}},t.getCalcSpentAvg2=function(e){const t=[];return s=>{t.push(s),t.length>10&&t.shift(),e(t.length,(t.reduce((e,t)=>e+t,0)/t.length).toFixed(1))}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(s(11));t.default=class{constructor(e,t,s,i){this.element=e,this.onStart=s,this.startable=t,this.onDelayChange=i,this.createPanel()}createPanel(){const e=()=>document.createElement("div"),t=e();t.classList.add(i.default.wrapper),this.element.appendChild(t);const s=e();s.classList.add(i.default.left),t.appendChild(s);const n=e();n.classList.add(i.default.right),t.appendChild(n);const l=e();l.classList.add(i.default.spentIndicator),n.appendChild(l),this.spentIndicator=l,this.spentIndicatorTemplate=((e,t)=>`Среднее время обсчёта за ${e} последних итераций, мс: ${t}`),this.spentIndicator.innerHTML=this.spentIndicatorTemplate(0,"?");const a=e();a.classList.add(i.default.iterationsIndicator),n.appendChild(a),this.iterationsIndicator=a,this.iterationsIndicatorTemplate=(e=>`Итераций: ${e}`),this.iterationsIndicator.innerHTML=this.iterationsIndicatorTemplate("?");const r=e();r.classList.add(i.default.delayWrapper);const o=e();o.innerHTML="Задержка между итерациями, мс:",r.appendChild(o);const c=document.createElement("select");if(c.innerHTML='\n    <option value="20">20</option>\n    <option value="100" selected>100</option>\n    <option value="500">500</option>\n    ',c.addEventListener("change",e=>this.onDelayChange(+e.target.value)),r.appendChild(c),s.appendChild(r),this.startable){const e=document.createElement("button");e.innerHTML="Запустить",e.addEventListener("click",e=>{e.target.removeEventListener("click",this.onStart),e.target.parentNode.removeChild(e.target),setTimeout(this.onStart,0)}),s.appendChild(e)}}updateSpentIndication(e,t){this.spentIndicator.innerHTML=this.spentIndicatorTemplate(e,t)}updateIterationsIndicator(e){this.iterationsIndicator.innerHTML=this.iterationsIndicatorTemplate(e)}}},function(e,t){e.exports={wrapper:"wrapper__S9Mm0",left:"left__3eC-H",right:"right__3dB-K",delayWrapper:"delayWrapper__2t3uC"}}]);